<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>JS Bin</title>
  <style>
    body {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>

<body>
  <input type="text" required="true" maxlength="true"  />
</body>

<script>



  // const input = document.querySelector('input')
  // const validate = $(input).attr('validate')
  // const value = $(input).value()
  // Validator.addRule(value, validate.split(',')).valid()

  const resultFactory = (isPass = false, errMsg = '') => {
    return {
      isPass,
      errMsg
    }
  }

  const required = 'required'
  const maxLength = 'maxLength'

  const ValidStrategies = {
    [required](val) {
      if (!val) return resultFactory(false, '不允许空')
    },
    [maxLength](val, length) {
      length = Number(length)
      if (val.length > length) return resultFactory(false, `长度不能大于${length}`)
    }

  }

  // 
  class Validator{
    constructor() {
      this.ruleExecuters = []
    }

    // Validator.addRule('123', ['required', '']).valid()
    addRule(val, rules) {
      this.ruleExecuters = []
      rules.forEach(rule => {
        const args = rule.split(':')
        const funName = args.shift()
        const ruleFun = ValidStrategies[funName].bind(this, val)
        this.ruleExecuters.push({
          fun: ruleFun,
          args
        })
      })
      return this
    }

    valid() {
      const { ruleExecuters } = this
      for (let i = 0; i < ruleExecuters.length; i++) {
        const res = ruleExecuters[i].fun.apply(this, ruleExecuters[i].args)
        if (res && !res.isPass) return res
      }
      return resultFactory(true)
    }
  }

  const validator = new Validator()
  console.log(validator.addRule('123', ['required', 'maxLength: 2']).valid())

  

  

  let a
</script>

</html>